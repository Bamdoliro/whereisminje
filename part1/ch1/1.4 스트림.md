모든 자바 애플리케이션은 컬렉션을 만들고 활용한다. 하지만 컬렉션으로 모든 문제가 해결되는 것은 아니다.

스트림 API를 이용하면 컬렉션 API와는 상당히 다른 방식으로 데이터를 처리할 수 있다.

컬렉션에서는 반복 과정을 직접처리해야 했다. for-each 루프를 이용해 각 요소를 반복하면서 작업을 수행했다. 이런 방식의 반복을 **외부 반복** 이라고 한다.

반면에 스트림 API를 이용하면 루프를 신경쓸 필요가 없다. 스트림 API에서는 라이브러리 내부에서 모든 데이터가 처리된다. 이와 같은 반복을 **내부 반복**이라고 한다.

## 1.4.1 멀티스레딩은 어렵다

이전 자바 버전에서 제공하는 스레드 API로 **멀티스레딩**코드를 구현해서 병렬성을 이용하는 것은 쉽지 않다.

멀티스레딩 환경에서 각각의 스레드는 동시에 공유된 데이터에 접근하고, 데이터를 갱신할 수 있다. 결과적으로 스레드를 잘 제어하지 못하면 원치 않는 방식으로 데이터가 바뀔 수 있다.

ex)
스레드 1: sum = sum + 3;
스레드 2: sum = sum + 5;

자바 8은 스트림 API로 **컬렉션을 처리하면서 발생하는 모호함과 반복적인 코드 문제** 그리고 **멀티코어 활용 어려움** 이라는 두 가지 문제를 모두 해결했다.

자주 반복되는 패턴으로 주어진 조건에 따라 데이터를 필터링(filtering), 추출(extracting), 그룹화(grouping)등의 기능이 있다.

p.58에 있는 그림과 같이 두 CPU를 가진 환경에서 리스트를 필터릴 할 때 각자의 CPU는 반 씩 담당을 하여 필터링을 한다. 이 과정을 **포킹 단계**라고 한다.

1. 각각의 CPU는 자신이 맡은 절반의 리스트를 처리한다
2. 마지막으로 하나의 CPU가 두 결과를 정리한다

지금은 새로운 스트림 API도 기존의 컬렉션 API와 아주 비슷한 방식으로 동작한다.

다만 컬렉션은 어떻게 데이터를 저장하고 접근할지에 중점을 두는 반면 스트림은 데이터에 어떤 계산을 할 것인지 묘사하는 것에 중점을 둔다. 스트림은 스트림 내의 요소를 쉽게 병렬로 처리 할 수 있는 환경을 제공한다.

컬렉션을 필터링 할 가장 빠른 방법은 컬렉션을 스트림으로 바꾸고, 병렬로 처리한 후 리스트로 다시 복원하는 것이다. 스트림과 람다 표현식을 이용하면 **병렬성을 공짜로** 얻을 수 있다.
